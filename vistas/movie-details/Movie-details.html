<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CineReseñas - Detalle de Película</title>
  <link rel="stylesheet" href="Movie-details.css">
</head>
<body>
  <header class="top-bar">
    <button class="back-btn" onclick="window.history.back()" title="Volver">⬅</button>
    <h1 class="page-title">Detalle de Película</h1>
  </header>

  <section class="movie-info">
    <img src="" alt="Cargando..." class="movie-poster" id="poster">
    
    <div class="movie-details">
      <h2 class="movie-title" id="title">Cargando...</h2>
      
      <p><strong>Director:</strong> <span id="director">...</span></p>
      <p><strong>Estreno:</strong> <span id="year">...</span></p>
      <p><strong>Género:</strong> <span id="genre">...</span></p>
      <p><strong>Idioma:</strong> <span id="language">...</span></p>
      <p><strong>Duración:</strong> <span id="duration">...</span> min</p>
      
      <p class="movie-desc" id="desc">Cargando sinopsis...</p>
    </div>
  </section>

  <section class="reviews">
    <h3 class="section-title">Reseñas de la Comunidad</h3>
    <div id="reviews-container">
        <p style="color:#ccc">Próximamente: Reseñas reales...</p>
    </div>
  </section>

  <button class="add-review-btn" title="Agregar reseña" onclick="irAAgregarResena()">➕</button>

  <script>
    function irAAgregarResena() {
        const params = new URLSearchParams(window.location.search);
        const movieId = params.get('id');
        if(movieId) location.href = `../add-review/Add-review.html?id=${movieId}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
      const params = new URLSearchParams(window.location.search);
      const movieId = params.get('id');

      if (!movieId) return;

      fetch(`../../controladores/get_movie_details_controller.php?id=${movieId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById('title').textContent = 'Película no encontrada';
            } else {
                // Rellenar datos básicos
                document.getElementById('title').textContent = data.nombre;
                document.getElementById('desc').textContent = data.sinopsis;
                document.getElementById('year').textContent = data.fecha_estreno;
                document.getElementById('duration').textContent = data.duracion;

                // === RELLENAR DATOS NUEVOS (Vienen separados por comas desde SQL) ===
                document.getElementById('director').textContent = data.directores || 'Desconocido';
                document.getElementById('genre').textContent = data.generos || 'Sin género';
                document.getElementById('language').textContent = data.idiomas || 'Desconocido';

                // Imagen
                const img = document.getElementById('poster');
                img.src = data.imagen || 'https://via.placeholder.com/300x450?text=No+Image';
                img.onerror = () => img.src = 'https://via.placeholder.com/300x450?text=Error';
            }
        })
        .catch(error => console.error('Error:', error));
    });
  </script>
</body>
</html>