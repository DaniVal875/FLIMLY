<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CineRese√±as - Inicio</title>
  <link rel="stylesheet" href="Home.css">
</head>

<body>
  <header class="top-bar">
    <h1 class="logo">üé¨ CineRese√±as</h1>
    <div class="search-box">
      <input type="text" placeholder="Buscar pel√≠culas..." id="searchInput">
      <button onclick="buscar()">üîç</button>
    </div>
  </header>
  <script>
    function buscar() {
      const query = document.getElementById("searchInput").value;
        if (query.trim() !== "") {
            window.location.href = `../search-results/Search-results.html?query=${encodeURIComponent(query)}`;
        }
    }
  </script>

  <main class="movies-section">
    <h2 class="section-title">Pel√≠culas Populares</h2>
    
    <div class="movie-grid" id="movie-grid">
      <p style="color: #ccc;">Cargando pel√≠culas...</p>
    </div>
  </main>

  <nav class="bottom-menu">
    <a onclick="location.href='../profile/Profile.html'" class="menu-item" title="Perfil">üë§</a>
    <a onclick="location.href='../logout/Logout.html'" class="menu-item" title="Salir">üö™</a>
  </nav>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 1. Llamamos al controlador que creamos
      fetch('../../controladores/get_movies_controller.php')
        .then(response => response.json())
        .then(data => {
          const grid = document.getElementById('movie-grid');
          grid.innerHTML = ''; // Limpiamos el mensaje de "Cargando..."

          // 2. Verificamos si hay pel√≠culas
          if (data.length > 0) {
            // 3. Recorremos cada pel√≠cula recibida de la base de datos
            data.forEach(movie => {
              // Creamos el enlace de la tarjeta
              const card = document.createElement('a');
              // Nota: Agregamos el ID a la URL para usarlo despu√©s en los detalles
              card.href = `../movie-details/Movie-details.html?id=${movie.id_pelicula}`;
              card.className = 'movie-card';

              // Creamos la imagen
              const img = document.createElement('img');
              img.src = movie.imagen || 'https://via.placeholder.com/200x300?text=No+Image'; // Imagen por defecto si falla
              img.alt = movie.nombre;
              
              // Si la imagen falla al cargar, ponemos una por defecto
              img.onerror = function() { 
                this.src = 'https://via.placeholder.com/200x300?text=Error+Img'; 
              };

              // Creamos el t√≠tulo
              const title = document.createElement('p');
              title.textContent = movie.nombre;

              // 4. Juntamos todo y lo agregamos al grid
              card.appendChild(img);
              card.appendChild(title);
              grid.appendChild(card);
            });
          } else {
            grid.innerHTML = '<p>No se encontraron pel√≠culas en la base de datos.</p>';
          }
        })
        .catch(error => {
          console.error('Error al cargar pel√≠culas:', error);
          document.getElementById('movie-grid').innerHTML = '<p>Error al cargar el contenido.</p>';
        });
    });
  </script>
</body>
</html>