<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CineReseÃ±as - Inicio</title>
  <link rel="stylesheet" href="Home.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>
  <header class="top-bar">
    <h1 class="logo">ğŸ¬ Filmly</h1>
    
    <button class="search-nav-btn" onclick="location.href='../search-results/Search-results.html'"> ğŸ”
    </button>
  </header>

  <main class="movies-section">
    
    <h2 class="section-title">ğŸ”¥ PelÃ­culas Populares</h2>
    <div class="movie-grid" id="popular-grid">
      <p style="color: #ccc;">Cargando populares...</p>
    </div>

    <br><br> <h2 class="section-title" id="dynamic-genre-title">âœ¨ Descubre mÃ¡s</h2>
    <div class="movie-grid" id="genre-grid">
      <p style="color: #ccc;">Buscando recomendaciones...</p>
    </div>

  </main>

  <nav class="bottom-menu">
    <a onclick="location.href='../profile/Profile.html'" class="menu-item" title="Perfil">ğŸ‘¤</a>
    <a onclick="location.href='../logout/Logout.html'" class="menu-item" title="Salir">ğŸšª</a>
  </nav>

  <script>
    // FunciÃ³n auxiliar para crear el HTML de una tarjeta de pelÃ­cula
    function createMovieCard(movie) {
        const card = document.createElement('a');
        // El enlace lleva al detalle pasando el ID
        card.href = `../movie-details/Movie-details.html?id=${movie.id_pelicula}`;
        card.className = 'movie-card';

        const img = document.createElement('img');
        // Si no hay imagen, usa un placeholder
        img.src = movie.imagen || 'https://via.placeholder.com/200x300?text=No+Image';
        img.alt = movie.nombre;
        // Si la imagen falla al cargar, pone una por defecto
        img.onerror = () => img.src = 'https://via.placeholder.com/200x300?text=Error';

        const title = document.createElement('p');
        title.textContent = movie.nombre;

        card.appendChild(img);
        card.appendChild(title);
        return card;
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Llamamos al controlador que nos da populares y gÃ©nero sorpresa
      fetch('../../controladores/get_home_dynamic.php')
        .then(response => response.json())
        .then(data => {
          
          // 1. Rellenar SecciÃ³n POPULARES
          const popularGrid = document.getElementById('popular-grid');
          popularGrid.innerHTML = ''; // Limpiar mensaje de carga
          
          if (data.populares && data.populares.length > 0) {
            data.populares.forEach(movie => {
              popularGrid.appendChild(createMovieCard(movie));
            });
          } else {
              popularGrid.innerHTML = '<p>No hay pelÃ­culas populares disponibles.</p>';
          }

          // 2. Rellenar SecciÃ³n GÃ‰NERO DINÃMICO
          const genreGrid = document.getElementById('genre-grid');
          const genreTitle = document.getElementById('dynamic-genre-title');
          genreGrid.innerHTML = ''; // Limpiar mensaje

          if (data.genero_titulo && data.genero_peliculas.length > 0) {
            // Actualizamos el tÃ­tulo (Ej: "PelÃ­culas de Terror")
            genreTitle.textContent = `PelÃ­culas de ${data.genero_titulo}`;
            
            data.genero_peliculas.forEach(movie => {
              genreGrid.appendChild(createMovieCard(movie));
            });
          } else {
             genreTitle.textContent = "Explora nuestro catÃ¡logo";
             genreGrid.innerHTML = '<p>No se encontraron recomendaciones especÃ­ficas hoy.</p>';
          }

        })
        .catch(error => {
          console.error('Error al cargar el Home:', error);
        });
    });
  </script>
</body>
</html>