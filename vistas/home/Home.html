<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CineRese√±as - Inicio</title>
  <link rel="stylesheet" href="Home.css">
</head>

<body>
  <header class="top-bar">
    <h1 class="logo">üé¨ CineRese√±as</h1>
    <div class="search-box">
      <input type="text" placeholder="Buscar pel√≠culas..." id="searchInput">
      <button onclick="buscar()">üîç</button>
    </div>
  </header>
  <script>
    function buscar() {
      const query = document.getElementById("searchInput").value;
        if (query.trim() !== "") {
            window.location.href = `../search-results/Search-results.html?query=${encodeURIComponent(query)}`;
        }
    }
  </script>

  <main class="movies-section">
    
    <h2 class="section-title">üî• Pel√≠culas Populares</h2>
    <div class="movie-grid" id="popular-grid">
      <p style="color: #ccc;">Cargando populares...</p>
    </div>

    <br><br> <h2 class="section-title" id="dynamic-genre-title">‚ú® Descubre m√°s</h2>
    <div class="movie-grid" id="genre-grid">
      <p style="color: #ccc;">Buscando recomendaciones...</p>
    </div>

  </main>

  <nav class="bottom-menu">
    <a onclick="location.href='../profile/Profile.html'" class="menu-item" title="Perfil">üë§</a>
    <a onclick="location.href='../logout/Logout.html'" class="menu-item" title="Salir">üö™</a>
  </nav>

  <script>
    // Funci√≥n auxiliar para crear tarjetas de pel√≠cula
    function createMovieCard(movie) {
        const card = document.createElement('a');
        card.href = `../movie-details/Movie-details.html?id=${movie.id_pelicula}`;
        card.className = 'movie-card';

        const img = document.createElement('img');
        img.src = movie.imagen || 'https://via.placeholder.com/200x300?text=No+Image';
        img.alt = movie.nombre;
        img.onerror = () => img.src = 'https://via.placeholder.com/200x300?text=Error';

        const title = document.createElement('p');
        title.textContent = movie.nombre;

        card.appendChild(img);
        card.appendChild(title);
        return card;
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Llamamos al nuevo controlador din√°mico
      fetch('../../controladores/get_home_dynamic.php')
        .then(response => response.json())
        .then(data => {
          
          // 1. Rellenar Secci√≥n POPULARES
          const popularGrid = document.getElementById('popular-grid');
          popularGrid.innerHTML = ''; // Limpiar mensaje de carga
          
          if (data.populares && data.populares.length > 0) {
            data.populares.forEach(movie => {
              popularGrid.appendChild(createMovieCard(movie));
            });
          } else {
              popularGrid.innerHTML = '<p>No hay pel√≠culas populares disponibles.</p>';
          }

          // 2. Rellenar Secci√≥n G√âNERO DIN√ÅMICO
          const genreGrid = document.getElementById('genre-grid');
          const genreTitle = document.getElementById('dynamic-genre-title');
          genreGrid.innerHTML = ''; // Limpiar mensaje

          if (data.genero_titulo && data.genero_peliculas.length > 0) {
            // Actualizamos el t√≠tulo (Ej: "Pel√≠culas de Terror")
            genreTitle.textContent = `Pel√≠culas de ${data.genero_titulo}`;
            
            data.genero_peliculas.forEach(movie => {
              genreGrid.appendChild(createMovieCard(movie));
            });
          } else {
             // Si por azar sale un g√©nero sin pel√≠culas, ocultamos la secci√≥n o mostramos mensaje
             genreTitle.textContent = "Explora nuestro cat√°logo";
             genreGrid.innerHTML = '<p>No se encontraron recomendaciones espec√≠ficas hoy.</p>';
          }

        })
        .catch(error => {
          console.error('Error:', error);
        });
    });
  </script>
</body>
</html>